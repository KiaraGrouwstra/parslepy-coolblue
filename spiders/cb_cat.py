"""coolblue product category spider"""
from re import sub
from scrapy import Spider
from scrapy.http import Request
from parsel import Selector
from toolz.curried import merge, pipe
from fp import pick, evolve

class CbCatSpider(Spider):
    """ CoolBlue category"""
    name = 'CoolBlueCat'
    allowed_domains = ['coolblue.nl']
    start_urls = ["https://www.coolblue.nl/producttype:laptops", "https://www.coolblue.nl/producttype:muizen", "https://www.coolblue.nl/producttype:gaming-muizen", "https://www.coolblue.nl/producttype:toetsenborden", "https://www.coolblue.nl/producttype:office-software", "https://www.coolblue.nl/producttype:laptoptassen", "https://www.coolblue.nl/producttype:speakers", "https://www.coolblue.nl/producttype:desktops", "https://www.coolblue.nl/producttype:monitoren", "https://www.coolblue.nl/producttype:barebones", "https://www.coolblue.nl/producttype:externe-ssds", "https://www.coolblue.nl/producttype:externe-harde-schijven", "https://www.coolblue.nl/producttype:interne-harde-schijven", "https://www.coolblue.nl/producttype:nas", "https://www.coolblue.nl/producttype:usb-sticks", "https://www.coolblue.nl/producttype:printers", "https://www.coolblue.nl/producttype:labelprinters", "https://www.coolblue.nl/producttype:laserprinters", "https://www.coolblue.nl/producttype:3d-printers", "https://www.coolblue.nl/producttype:routers", "https://www.coolblue.nl/producttype:powerline-adapters", "https://www.coolblue.nl/producttype:switches", "https://www.coolblue.nl/producttype:access-points", "https://www.coolblue.nl/producttype:wifi-repeaters", "https://www.coolblue.nl/producttype:wasmachines", "https://www.coolblue.nl/producttype:mini-wasmachines", "https://www.coolblue.nl/producttype:was-droogcombinaties", "https://www.coolblue.nl/producttype:wasdrogers", "https://www.coolblue.nl/producttype:vrijstaande-koelkasten", "https://www.coolblue.nl/producttype:inbouw-koelkasten", "https://www.coolblue.nl/producttype:vriezers", "https://www.coolblue.nl/producttype:vaatwassers", "https://www.coolblue.nl/producttype:inbouw-vaatwassers", "https://www.coolblue.nl/producttype:magnetrons", "https://www.coolblue.nl/producttype:inbouw-magnetrons", "https://www.coolblue.nl/producttype:mini-ovens", "https://www.coolblue.nl/producttype:inbouw-ovens", "https://www.coolblue.nl/producttype:fornuizen", "https://www.coolblue.nl/producttype:inbouw-gaskookplaten", "https://www.coolblue.nl/producttype:vrijstaande-gaskookplaten", "https://www.coolblue.nl/producttype:inbouw-kookplaten", "https://www.coolblue.nl/producttype:vrijstaande-kookplaten", "https://www.coolblue.nl/producttype:afzuigkappen", "https://www.coolblue.nl/producttype:stofzuigers", "https://www.coolblue.nl/producttype:robotstofzuigers", "https://www.coolblue.nl/producttype:kruimeldieven", "https://www.coolblue.nl/producttype:strijkijzers", "https://www.coolblue.nl/producttype:stoomreinigers", "https://www.coolblue.nl/producttype:naaimachines", "https://www.coolblue.nl/producttype:prullenbakken", "https://www.coolblue.nl/producttype:personenweegschalen", "https://www.coolblue.nl/producttype:luchtbevochtigers", "https://www.coolblue.nl/producttype:televisies", "https://www.coolblue.nl/producttype:beamers", "https://www.coolblue.nl/producttype:home-cinema-sets", "https://www.coolblue.nl/producttype:receivers", "https://www.coolblue.nl/producttype:versterkers", "https://www.coolblue.nl/producttype:blu-ray-spelers", "https://www.coolblue.nl/producttype:soundbars", "https://www.coolblue.nl/producttype:televisiebeugels", "https://www.coolblue.nl/producttype:afstandsbedieningen", "https://www.coolblue.nl/producttype:mediaspelers", "https://www.coolblue.nl/producttype:hoofdtelefoons", "https://www.coolblue.nl/producttype:oordopjes", "https://www.coolblue.nl/producttype:bluetooth-speakers", "https://www.coolblue.nl/producttype:mp3-spelers", "https://www.coolblue.nl/producttype:autoradios", "https://www.coolblue.nl/producttype:bluetooth-headsets", "https://www.coolblue.nl/producttype:gaming-headsets", "https://www.coolblue.nl/producttype:office-headsets", "https://www.coolblue.nl/producttype:headsets-voor-walkie-talkies", "https://www.coolblue.nl/producttype:audiostreamers", "https://www.coolblue.nl/producttype:radios", "https://www.coolblue.nl/producttype:platenspelers", "https://www.coolblue.nl/producttype:cd-spelers", "https://www.coolblue.nl/producttype:mobiele-telefoons", "https://www.coolblue.nl/producttype:tablets", "https://www.coolblue.nl/producttype:tablethoesjes", "https://www.coolblue.nl/producttype:e-readers", "https://www.coolblue.nl/producttype:powerbanks", "https://www.coolblue.nl/producttype:autoladers", "https://www.coolblue.nl/producttype:thuisladers", "https://www.coolblue.nl/producttype:telefoonhouders", "https://www.coolblue.nl/producttype:geheugenkaarten", "https://www.coolblue.nl/producttype:smartwatches", "https://www.coolblue.nl/producttype:vr-brillen", "https://www.coolblue.nl/producttype:vaste-telefoons", "https://www.coolblue.nl/producttype:walkie-talkies", "https://www.coolblue.nl/producttype:inbouw-vriezers", "https://www.coolblue.nl/producttype:inbouw-wasmachines", "https://www.coolblue.nl/producttype:pannen", "https://www.coolblue.nl/producttype:friteuses", "https://www.coolblue.nl/producttype:barbecues", "https://www.coolblue.nl/producttype:contactgrills", "https://www.coolblue.nl/producttype:grillplaten", "https://www.coolblue.nl/producttype:slowcookers", "https://www.coolblue.nl/producttype:broodroosters", "https://www.coolblue.nl/producttype:halfautomatische-espressomachines", "https://www.coolblue.nl/producttype:volautomatische-espressomachines", "https://www.coolblue.nl/producttype:cup-en-padmachines", "https://www.coolblue.nl/producttype:filterkoffieapparaten", "https://www.coolblue.nl/producttype:waterkokers", "https://www.coolblue.nl/producttype:keukenmixers", "https://www.coolblue.nl/producttype:foodprocessors", "https://www.coolblue.nl/producttype:blenders", "https://www.coolblue.nl/producttype:staafmixers", "https://www.coolblue.nl/producttype:handmixers", "https://www.coolblue.nl/producttype:juicers", "https://www.coolblue.nl/producttype:keukenmessen", "https://www.coolblue.nl/producttype:snijmachines", "https://www.coolblue.nl/producttype:smart-lampen", "https://www.coolblue.nl/producttype:serviessets", "https://www.coolblue.nl/producttype:besteksets", "https://www.coolblue.nl/producttype:wekkers", "https://www.coolblue.nl/producttype:luchtreinigers", "https://www.coolblue.nl/producttype:luchtontvochtigers", "https://www.coolblue.nl/producttype:ventilatoren", "https://www.coolblue.nl/producttype:mobiele-aircos", "https://www.coolblue.nl/producttype:thermostaten", "https://www.coolblue.nl/producttype:weerstations", "https://www.coolblue.nl/producttype:ip-cameras", "https://www.coolblue.nl/producttype:babyfoons", "https://www.coolblue.nl/producttype:alarmsystemen", "https://www.coolblue.nl/producttype:rookmelders", "https://www.coolblue.nl/producttype:deurbellen", "https://www.coolblue.nl/producttype:sporthorloges", "https://www.coolblue.nl/producttype:activiteitstrackers", "https://www.coolblue.nl/producttype:hartslagmetersensoren", "https://www.coolblue.nl/producttype:borstbanden", "https://www.coolblue.nl/producttype:stappentellers", "https://www.coolblue.nl/producttype:action-cameras", "https://www.coolblue.nl/producttype:buiktrainers", "https://www.coolblue.nl/producttype:hometrainers", "https://www.coolblue.nl/producttype:crosstrainers", "https://www.coolblue.nl/producttype:roeitrainers", "https://www.coolblue.nl/producttype:loopbanden", "https://www.coolblue.nl/producttype:fitnessbanken", "https://www.coolblue.nl/producttype:epilatoren", "https://www.coolblue.nl/producttype:tondeuses", "https://www.coolblue.nl/producttype:bodygrooms", "https://www.coolblue.nl/producttype:lichtontharingsapparaten", "https://www.coolblue.nl/producttype:scheerapparaten", "https://www.coolblue.nl/producttype:baardtrimmers", "https://www.coolblue.nl/producttype:neustrimmers", "https://www.coolblue.nl/producttype:multigrooms", "https://www.coolblue.nl/producttype:ladyshaves", "https://www.coolblue.nl/producttype:sportarmbanden", "https://www.coolblue.nl/producttype:sportbrillen", "https://www.coolblue.nl/producttype:drinksystemen", "https://www.coolblue.nl/producttype:fietscomputers", "https://www.coolblue.nl/producttype:fietsnavigatie", "https://www.coolblue.nl/producttype:tandenborstels", "https://www.coolblue.nl/producttype:tandenborstel-opzetborstels", "https://www.coolblue.nl/producttype:flosapparaten", "https://www.coolblue.nl/producttype:fohns", "https://www.coolblue.nl/producttype:stijltangen", "https://www.coolblue.nl/producttype:krultangen", "https://www.coolblue.nl/producttype:gezichtsborstels", "https://www.coolblue.nl/producttype:massagekussens", "https://www.coolblue.nl/producttype:voetmassage-apparaten", "https://www.coolblue.nl/producttype:handmassage-apparaten", "https://www.coolblue.nl/producttype:elektrische-dekens", "https://www.coolblue.nl/producttype:voetenbaden", "https://www.coolblue.nl/producttype:warmtekussens", "https://www.coolblue.nl/producttype:bloeddrukmeters", "https://www.coolblue.nl/producttype:koffers", "https://www.coolblue.nl/producttype:reistassen", "https://www.coolblue.nl/producttype:backpacks", "https://www.coolblue.nl/producttype:rugzakken", "https://www.coolblue.nl/producttype:autonavigatiesystemen", "https://www.coolblue.nl/producttype:motornavigatiesystemen", "https://www.coolblue.nl/producttype:wandelnavigatiesystemen", "https://www.coolblue.nl/producttype:fietsendragers", "https://www.coolblue.nl/producttype:portable-dvd-spelers", "https://www.coolblue.nl/producttype:carkits", "https://www.coolblue.nl/producttype:dashcams", "https://www.coolblue.nl/producttype:autostoelen", "https://www.coolblue.nl/producttype:koelboxen", "https://www.coolblue.nl/producttype:tenten", "https://www.coolblue.nl/producttype:luchtbedden", "https://www.coolblue.nl/producttype:zaklampen", "https://www.coolblue.nl/producttype:zakmessen", "https://www.coolblue.nl/producttype:verrekijkers", "https://www.coolblue.nl/producttype:fietstassen", "https://www.coolblue.nl/producttype:fietsstoeltjes", "https://www.coolblue.nl/producttype:spiegelreflexcameras", "https://www.coolblue.nl/producttype:compactcameras", "https://www.coolblue.nl/producttype:systeemcameras", "https://www.coolblue.nl/producttype:lenzen", "https://www.coolblue.nl/producttype:flitsers", "https://www.coolblue.nl/producttype:lensfilters", "https://www.coolblue.nl/producttype:accus-camera", "https://www.coolblue.nl/producttype:draagriemen", "https://www.coolblue.nl/producttype:montagesets-voor-sportscams", "https://www.coolblue.nl/producttype:statieven", "https://www.coolblue.nl/producttype:selfie-sticks", "https://www.coolblue.nl/producttype:cameratassen", "https://www.coolblue.nl/producttype:microfoons", "https://www.coolblue.nl/producttype:camcorders", "https://www.coolblue.nl/producttype:360-graden-cameras", "https://www.coolblue.nl/producttype:achtergrondsystemen", "https://www.coolblue.nl/producttype:studiolampen", "https://www.coolblue.nl/producttype:foto-en-of-videosoftware", "https://www.coolblue.nl/producttype:hogedrukreinigers", "https://www.coolblue.nl/producttype:grasmaaiers", "https://www.coolblue.nl/producttype:robotmaaiers", "https://www.coolblue.nl/producttype:grastrimmers", "https://www.coolblue.nl/producttype:heggenscharen", "https://www.coolblue.nl/producttype:tuinslangen", "https://www.coolblue.nl/producttype:verticuteermachines", "https://www.coolblue.nl/producttype:bladblazers", "https://www.coolblue.nl/producttype:buitenverlichting", "https://www.coolblue.nl/producttype:terrasverwarmers", "https://www.coolblue.nl/producttype:vuurkorven-en-vuurschalen", "https://www.coolblue.nl/producttype:tuinhaarden", "https://www.coolblue.nl/producttype:vuurtafels", "https://www.coolblue.nl/producttype:boormachines", "https://www.coolblue.nl/producttype:schroefmachines", "https://www.coolblue.nl/producttype:afkortzagen", "https://www.coolblue.nl/producttype:schuurmachines", "https://www.coolblue.nl/producttype:trampolines", "https://www.coolblue.nl/producttype:steppen", "https://www.coolblue.nl/producttype:skelters", "https://www.coolblue.nl/producttype:zwembaden", "https://www.coolblue.nl/producttype:jacuzzis", "https://www.coolblue.nl/producttype:multitools", "https://www.coolblue.nl/producttype:haakse-slijpers", "https://www.coolblue.nl/producttype:bovenfrezen", "https://www.coolblue.nl/producttype:gereedschapsets", "https://www.coolblue.nl/producttype:compressors", "https://www.coolblue.nl/producttype:ladders", "https://www.coolblue.nl/producttype:bouwstofzuigers", "https://www.coolblue.nl/producttype:workmates", "https://www.coolblue.nl/producttype:laserafstandsmeters", "https://www.coolblue.nl/producttype:bouwradios", "https://www.coolblue.nl/producttype:consoles", "https://www.coolblue.nl/producttype:games", "https://www.coolblue.nl/producttype:controllers", "https://www.coolblue.nl/producttype:gaming-toetsenborden", "https://www.coolblue.nl/producttype:gaming-stoelen", "https://www.coolblue.nl/producttype:racesturen", "https://www.coolblue.nl/producttype:robotballen", "https://www.coolblue.nl/producttype:styli", "https://www.coolblue.nl/producttype:portemonnees", "https://www.coolblue.nl/producttype:horlogebanden", "https://www.coolblue.nl/producttype:domotica", "https://www.coolblue.nl/producttype:Magnetrons", "https://www.coolblue.nl/producttype:cadeaubonnen", "https://www.coolblue.nl/producttype:tekentablets", "https://www.coolblue.nl/producttype:Was-droogcombinaties", "https://www.coolblue.nl/producttype:Vriezers", "https://www.coolblue.nl/producttype:Barbecues", "https://www.coolblue.nl/producttype:Terrasverwarmers", "https://www.coolblue.nl/producttype:Statieven"]

    def parse(self, response):
        sel = Selector(text=response.body.decode('utf-8'))
        products = sel.css('.product__title::attr(href)').extract()
        yield \
            merge({'products': products}, \
            pick(['status', '_url'], \
            vars(response)))
        url = sel.css('.js-next::attr(href)').extract_first()
        if url:
            req = sub(r'\?.*', '', response.request.url) + url
            yield Request(req, callback=self.parse)
